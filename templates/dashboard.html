{% extends "base.html" %}

{% block content %}
<!-- Page Header -->
<div class="page-header py-3">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h1 class="h3 fw-bold mb-0">Dashboard Analítico</h1>
                <p class="text-muted small mb-0">Visualização geral dos certificados</p>
            </div>
            <div class="col-md-6 text-md-end mt-2 mt-md-0">
                <a href="{{ url_for('listar_certificados') }}" class="btn btn-primary btn-sm">
                    <i class="fas fa-list me-2"></i>Ver Lista Completa
                </a>
            </div>
        </div>
    </div>
</div>

<div class="container mt-3">
    <!-- Stats Cards -->
    <div class="row g-3 mb-3">
        <div class="col-md-3">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body p-3 text-center">
                    <h6 class="text-muted small mb-1">Total de Certificados</h6>
                    <h3 class="mb-0">{{ stats.total_certificados }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body p-3 text-center">
                    <h6 class="text-success small mb-1">Certificados Válidos</h6>
                    <h3 class="mb-0">{{ stats.validos }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body p-3 text-center">
                    <h6 class="text-warning small mb-1">Próximos ao Vencimento</h6>
                    <h3 class="mb-0">{{ stats.proximos_vencer }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body p-3 text-center">
                    <h6 class="text-danger small mb-1">Certificados Expirados</h6>
                    <h3 class="mb-0">{{ stats.expirados }}</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts -->
    <div class="row g-3">
        <!-- Pie Chart -->
        <div class="col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-3">
                    <h6 class="card-title mb-3">Status dos Certificados</h6>
                    <div style="height: 250px;">
                        <canvas id="statusPieChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bar Chart -->
        <div class="col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-3">
                    <h6 class="card-title mb-3">Certificados por Mês de Vencimento</h6>
                    <div style="height: 250px;">
                        <canvas id="monthlyBarChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Dados dos gráficos
    const chartData = {{ chart_data|tojson|safe }};

    // Configuração das cores
    const colors = {
        valid: '#198754',      // Verde para Válido
        warning: '#ffc107',    // Amarelo para Próximo ao Vencimento
        danger: '#dc3545',     // Vermelho para Expirado
        background: '#f8f9fa'  // Cor de fundo
    };

    // Gráfico de Pizza - Status
    const statusCtx = document.getElementById('statusPieChart');
    if (statusCtx) {
        new Chart(statusCtx, {
            type: 'doughnut',
            data: {
                labels: chartData.status_labels,
                datasets: [{
                    data: chartData.status_data,
                    backgroundColor: [
                        colors.valid,
                        colors.warning,
                        colors.danger
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '60%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true,
                            pointStyle: 'circle'
                        }
                    }
                }
            }
        });
    }

    // Gráfico de Barras - Mensal
    const monthlyCtx = document.getElementById('monthlyBarChart');
    if (monthlyCtx) {
        new Chart(monthlyCtx, {
            type: 'bar',
            data: {
                labels: chartData.meses_labels,
                datasets: [{
                    label: 'Certificados',
                    data: chartData.meses_data,
                    backgroundColor: colors.valid,
                    borderColor: colors.valid,
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1,
                            font: {
                                size: 11
                            }
                        }
                    },
                    x: {
                        ticks: {
                            font: {
                                size: 11
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }
});
</script>
{% endblock %}
{% endblock %} 